<%= simple_nested_form_for [deal, packing_list] do |form| %>
  <%= form.input :shipping_method, collection: PackingList.shipping_methods.keys.collect { |k| [k.humanize, k] }  %>
  <div class="row">
    <div class="small-6 column">
      <h5>Address</h5>
      <%= form.fields_for :address do |address_form| %>
        <%= address_form.input :name %>
        <%= address_form.input :address1 %>
        <%= address_form.input :address2 %>
        <%= address_form.input :city %>
        <%= address_form.input :postal_code %>
        <%= address_form.input :country_code, collection: (ISO3166::Country.all.collect {|c| [c.name, c.alpha2]}.sort_by{|name, code| name} - [["Netherlands Antilles", "AN"], ["Åland Islands", "AX"]]).unshift(["Åland Islands", "AX"]), input_html: {class: "country-select"} %>
        <%= address_form.input :state, collection: address_form.object.country_code.present? ? (ISO3166::Country[sa.object.country_code].states.collect{|s|s.last['name']}) : [], input_html: {class: "state-select"} %>
      <% end %>
    </div>
    <div class="small-6 column">
      <%= form.input :department %>
    </div>
  </div>
  <div class="callout">
    <h5>PIC</h5>
    <%= form.fields_for :pics do |pic_form| %>
      <div class="row">
        <div class="column">
          <%= pic_form.input :name %>
        </div>
        <div class="column">
          <%= pic_form.input :tel %>
        </div>
        <div class="column">
          <%= pic_form.input :title %>
        </div>
        <div class="column align-self-bottom">
          <%= pic_form.link_to_remove class: "button alert remove-button" do %>
            <i class="fa fa-times" aria-hidden="true"></i>
          <% end %>
        </div>
      </div>
    <% end %>
    <%= form.link_to_add "Add PIC", :pics, class: "button warning" %>
  </div>

  <div class="row">
    <div class="column">
      <%= form.button :submit %>
    </div>
  </div>

  <% deal.job_requests_with_designs.each do |job_request| %>
    <%= job_request.design_name %>
    <table>
      <thead>
        <tr>
          <th>Product</th>
          <th>Color</th>
          <% job_request.selected_sizes.each do |size| %>
            <th><%= size.name %></th>
          <% end %>
        </tr>
      </thead>
      <tbody>
        <% job_request.selected_colors.each do |color| %>
          <tr>
            <th><%= job_request.product.name %></th>
            <th><%= color.name %></th>
            <%= form.fields_for :packing_list_items do |item_form| %>
              <td><%= item_form.input :quantity %></td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
<% end %>
